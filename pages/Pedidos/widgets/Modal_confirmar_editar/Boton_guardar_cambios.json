{
  "animateLoading": true,
  "borderRadius": "{{appsmith.theme.borderRadius.appBorderRadius}}",
  "bottomRow": 30,
  "boxShadow": "none",
  "buttonColor": "#22c55e",
  "buttonStyle": "PRIMARY_BUTTON",
  "buttonVariant": "PRIMARY",
  "disabledWhenInvalid": false,
  "dynamicBindingPathList": [
    {
      "key": "borderRadius"
    },
    {
      "key": "isDisabled"
    }
  ],
  "dynamicPropertyPathList": [
    {
      "key": "isDisabled"
    },
    {
      "key": "onClick"
    }
  ],
  "dynamicTriggerPathList": [
    {
      "key": "onClick"
    }
  ],
  "isDefaultClickDisabled": true,
  "isDisabled": "{{ !Chk_entiendo.isChecked }}",
  "isLoading": false,
  "isVisible": true,
  "key": "ffwdv9n8py",
  "leftColumn": 13,
  "minWidth": 120,
  "mobileBottomRow": 22,
  "mobileLeftColumn": 47,
  "mobileRightColumn": 63,
  "mobileTopRow": 18,
  "needsErrorInfo": false,
  "onClick": "{{\n(async () => {\n  try {\n    // 0) Validar que el usuario marcó el check de confirmación\n    if (!Chk_entiendo?.isChecked) {\n      showAlert(\"Debes marcar la casilla de confirmación para continuar.\", \"warning\");\n      return;\n    }\n\n    // Evitar doble envío sobre el mismo botón si alguna operación ya está corriendo\n    if (\n      UpdatePedidos.isLoading ||\n      UpdateInventarioEditOld.isLoading ||\n      UpdateInventarioEditNew.isLoading ||\n      InsertOTOld.isLoading ||\n      InsertOTNew.isLoading\n    ) {\n      return;\n    }\n\n    const cambioBano = !!appsmith.store.cambio_bano;\n    const idBanoOriginal = appsmith.store.bano_original_pedido || null;\n    const estatusBanoOriginal = appsmith.store.estatus_bano_original || null;\n    const idBanoNuevo = appsmith.store.bano_nuevo_seleccionado || null;\n    const pedido = appsmith.store.cliente_edit_row || {};\n\n    // 1) Si NO hubo cambio de baño: solo actualizamos el pedido\n    if (!cambioBano) {\n      await UpdatePedidos.run();\n      showAlert(\"Pedido actualizado correctamente (sin cambio de baño).\", \"success\");\n    } else {\n      // 2) SÍ hubo cambio de baño\n\n      // --- 2.1 Actualizar baño original (UpdateInventarioEditOld) ---\n      // NOTA: según tu punto A, de momento dejamos el mismo estatus que ya tiene.\n      // Si en el futuro quieres cambiarlo (ej. a \"Disponible en almacen\"), aquí sería el lugar.\n      await UpdateInventarioEditOld.run({\n        // Si tu query usa params distintos, ajústalos aquí\n        id_bano: idBanoOriginal,\n        estatus_bano: estatusBanoOriginal\n      });\n\n      // --- 2.2 Actualizar baño nuevo (UpdateInventarioEditNew) ---\n      // Al nuevo baño le copiamos el estatus del baño original.\n      await UpdateInventarioEditNew.run({\n        id_bano: idBanoNuevo,\n        estatus_bano: estatusBanoOriginal\n      });\n\n// --- 2.3 Calcular fecha_programada = mañana ---\nconst hoy = new Date();\nconst manana = new Date(hoy.getFullYear(), hoy.getMonth(), hoy.getDate() + 1);\nconst yyyy = manana.getFullYear();\nconst mm = String(manana.getMonth() + 1).padStart(2, \"0\");\nconst dd = String(manana.getDate()).padStart(2, \"0\");\nconst fechaProgramada = `${yyyy}-${mm}-${dd}`;  // \"YYYY-MM-DD\"\n\n// Guardar en store para usarla en los queries\nawait storeValue(\"fecha_programada_ot\", fechaProgramada, true);\n      // --- 2.4 InsertOTOld: Recolección con cliente ---\n      await InsertOTOld.run({\n        id_bano: idBanoOriginal,\n        nombre_ubicacion: pedido.nombre_ubicacion || null,\n        id_ruta: pedido.id_ruta || null,\n        id_item_pedido: pedido.id_item_pedido || null,\n        id_ubicacion: pedido.id_ubicacion || null,\n        geolocalizacion_ubicacion: pedido.geolocalizacion_ubicacion || null,\n        actividad_programada: \"Recoleccion con cliente\",\n        estatus_ot: \"Activa\",\n        fecha_programada: fechaProgramada\n      });\n\n      // --- 2.5 InsertOTNew: Entrega con cliente ---\n      await InsertOTNew.run({\n        id_bano: idBanoNuevo,\n        nombre_ubicacion: pedido.nombre_ubicacion || null,\n        id_ruta: pedido.id_ruta || null,\n        id_item_pedido: pedido.id_item_pedido || null,\n        id_ubicacion: pedido.id_ubicacion || null,\n        geolocalizacion_ubicacion: pedido.geolocalizacion_ubicacion || null,\n        actividad_programada: \"Entrega con cliente\",\n        estatus_ot: \"Activa\",\n        fecha_programada: fechaProgramada\n      });\n\n      // --- 2.6 Actualizar pedido con el cuerpo que ya tienes (UpdatePedidos) ---\n      await UpdatePedidos.run();\n\n      showAlert(\"Pedido y cambio de baño actualizados correctamente.\", \"success\");\n    }\n\n    // 3) Refrescar pedidos\n    if (GetPedidos?.run) {\n      await GetPedidos.run();\n    }\n\n    // 4) Cerrar modales\n    closeModal(\"Modal_confirmar_editar\");\n    closeModal(\"Modal_Editar\");\n  } catch (e) {\n    showAlert(\"Error al guardar: \" + (e?.message ?? e), \"error\");\n  }\n})()\n}}",
  "originalBottomRow": 30,
  "originalTopRow": 26,
  "parentId": "7h5qu95wta",
  "placement": "CENTER",
  "recaptchaType": "V3",
  "renderMode": "CANVAS",
  "resetFormOnClick": false,
  "responsiveBehavior": "hug",
  "rightColumn": 29,
  "text": "Confirmar",
  "topRow": 26,
  "type": "BUTTON_WIDGET",
  "version": 1,
  "widgetId": "pti4wamh7c",
  "widgetName": "Boton_guardar_cambios"
}